rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // --- Admin & System Configuration ---

    // Allows reading the admin credentials document for login.
    // In production, write access MUST be locked down.
    match /admin_config/main_credentials {
      allow read: if true;
      allow write: if false; // Prevent client-side writes.
    }

    // --- Application Submissions ---
    // The backend server actions handle all CUD operations.
    // These rules are permissive for development.
    match /contactSubmissions/{submissionId} {
      allow read, write: if true;
    }

    // Rule for the new off-campus applications collection.
    match /offCampusApplications/{applicationId} {
      allow read, write: if true;
    }

    // --- Main Data Collections ---
    // These are managed by the admin panel via server actions.
    // Permissive for development. Restrict to admin in production.
    match /startups/{startupId} {
      allow read, write: if true;
    }
    match /events/{eventId} {
      allow read, write: if true;
    }
    match /mentors/{mentorId} {
      allow read, write: if true;
    }

    // --- User-Specific Data ---

    // A user can only read and write to their own document.
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // A user can read/write their own mentor requests. Admin needs broader access.
    // For dev, we keep it simple.
    match /mentorRequests/{requestId} {
      allow read, write: if true;
    }

    // Notifications are created by server actions, but read by users.
    match /notifications/{notificationId} {
      allow read, write: if true;
    }

    // Email tokens should ideally only be accessed by the server.
    // Permissive for development.
    match /emailTokens/{tokenId} {
      allow read, write: if true;
    }
  }
}
